---
import Layout from '../layouts/Layout.astro';
import CopyTextComponent from '../components/CopyTextComponent.svelte';
---

<Layout>
  <form method="GET" action="/">
    <button type="submit">Home</button>
  </form>

  [[ if .NewAppSecret ]]
  <div>New application secret:
    <CopyTextComponent client:only="svelte" text="[[ .NewAppSecret ]]"/>
    for [[ .NewAppName ]]
  </div>
  [[ end ]]

  <h2>Manage Client Applications</h2>
  <form method="GET" action="/manage/apps/create">
    <button type="submit">New Client Application</button>
  </form>
  [[ if eq (len .Apps) 0 ]]
  <div>No client applications found</div>
  [[ else ]]
  <table>
    <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Domain</th>
      <th>Perms</th>
      <th>SSO</th>
      <th>Active</th>
      <th>Owner</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    [[ range .Apps ]]
    <tr>
      <td>[[ .Subject ]]</td>
      <td>[[ .Name ]]</td>
      <td>[[ .Domain ]]</td>
      <td>[[ .Perms ]]</td>
      <td>[[ .Sso ]]</td>
      <td>[[ .Active ]]</td>
      <td>[[ .Owner ]]</td>
      <td>
        <form method="GET" action="/manage/apps">
          <input type="hidden" name="offset" value="[[ $.Offset ]]"/>
          <input type="hidden" name="edit" value="[[ .Subject ]]"/>
          <button type="submit">Edit</button>
        </form>
        <form method="POST" action="/manage/apps?offset=[[ $.Offset ]]">
          <input type="hidden" name="action" value="secret"/>
          <input type="hidden" name="offset" value="[[ $.Offset ]]"/>
          <input type="hidden" name="subject" value="[[ .Subject ]]"/>
          <button type="submit">Reset Secret</button>
        </form>
      </td>
    </tr>
    [[ end ]]
    </tbody>
  </table>
  [[ end ]]
</Layout>
